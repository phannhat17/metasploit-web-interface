from flask import Blueprint, jsonify, request
import subprocess
import os
import datetime
from pymetasploit3.msfrpc import MsfRpcClient

# Initialize the Blueprint
exploit = Blueprint('exploit', __name__)
msfpass = os.getenv('MSFPASS', 'yourpassword')  
client = MsfRpcClient(msfpass, port=55553, ssl=True)

@exploit.route('/options', methods=["GET"])
def method_info():

    module_type = request.args.get('type')
    module_name = request.args.get('name')

    exploit = client.modules.use(module_type, module_name)

    res = {"all_options": exploit.options, "missing_required": exploit.missing_required, 'required': exploit.required, "current_set": exploit.runoptions }
    return jsonify(res)